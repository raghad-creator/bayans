// --- الترجمات ---
const translations = {
  ar: {
    welcome: 'مرحباً بك في Bayan Salary',
    desc: 'خدمة مقدمة من البنك العربي الوطني (ANB)',
    home: 'الرئيسية',
    account: 'كشف الحساب',
    transfer: 'التحويل',
    salary: 'تتبع الراتب',
    atm: 'أقرب صراف',
    support: 'الدعم الفني',
    back: 'عودة',
    update: 'تحديث العد',
    confirm: 'تأكيد التحويل',
    transfer_money: 'تحويل الأموال',
    recipient: 'المستلم:',
    amount: 'المبلغ (ر.س):',
    note: 'ملاحظة:',
    date: 'التاريخ',
    desc: 'الوصف',
    amount_col: 'المبلغ (ر.س)',
    salary_transfer: 'تحويل راتب',
    electricity_bill: 'فاتورة الكهرباء',
    water_bill: 'فاتورة المياه',
    fuel_purchase: 'شراء بنزين',
    restaurant_purchase: 'شراء من مطعم',
    balance: 'رصيد الحساب:',
    phone: 'الهاتف: 0551764832',
    email: 'البريد: raa7240@gmail.com',
    address: 'الرياض، شارع الملك فهد',
    account_desc: 'عرض رصيدك وتفاصيل المعاملات',
    transfer_desc: 'تحويل الأموال بسهولة وآمان',
    salary_desc: 'كم يوم بقي على الراتب؟',
    atm_desc: 'اعثر على أقرب صراف بنكي',
    support_desc: 'لأي استفسار، نحن هنا',
    atm_desc2: 'نعرض لك أقرب فروع البنك العربي الوطني (ANB)',
    sara: 'سارة',
    raghd: 'رغد',
    jawhara: 'الجوهرة',
    find_atm: 'ابحث عن أقرب صراف',
    open_map: 'افتح في Google Maps'
  },
  en: {
    welcome: 'Welcome to Bayan Salary',
    desc: 'Service provided by ANB National Bank',
    home: 'Home',
    account: 'Account',
    transfer: 'Transfer',
    salary: 'Salary',
    atm: 'ATM',
    support: 'Support',
    back: 'Back',
    update: 'Update',
    confirm: 'Confirm Transfer',
    transfer_money: 'Transfer money',
    recipient: 'Recipient:',
    amount: 'Amount (SAR):',
    note: 'Note:',
    date: 'Date',
    desc: 'Description',
    amount_col: 'Amount (SAR)',
    salary_transfer: 'Salary Transfer',
    electricity_bill: 'Electricity Bill',
    water_bill: 'Water Bill',
    fuel_purchase: 'Fuel Purchase',
    restaurant_purchase: 'Restaurant Purchase',
    balance: 'Account Balance:',
    phone: 'Phone: 0551764832',
    email: 'Email: raa7240@gmail.com',
    address: 'Riyadh, King Fahd Street',
    account_desc: 'View your balance and transaction details',
    transfer_desc: 'Transfer money easily and securely',
    salary_desc: 'How many days left until salary?',
    atm_desc: 'Find the nearest ATM',
    support_desc: 'We are here for you',
    atm_desc2: 'We show you the nearest ANB branches',
    sara: 'Sara',
    raghd: 'Raghad',
    jawhara: 'Jawhara',
    find_atm: 'Find Nearest ATM',
    open_map: 'Open in Google Maps'
  },
  fr: {
    welcome: 'Bienvenue sur Bayan Salary',
    desc: 'Service fourni par ANB Banque Nationale',
    home: 'Accueil',
    account: 'Compte',
    transfer: 'Transfert',
    salary: 'Salaire',
    atm: 'Distributeur',
    support: 'Support',
    back: 'Retour',
    update: 'Mettre à jour',
    confirm: 'Confirmer le transfert',
    transfer_money: 'Transfert d\'argent',
    recipient: 'Destinataire :',
    amount: 'Montant (SAR) :',
    note: 'Note :',
    date: 'Date',
    desc: 'Description',
    amount_col: 'Montant (SAR)',
    salary_transfer: 'Virement salaire',
    electricity_bill: 'Facture d\'électricité',
    water_bill: 'Facture d\'eau',
    fuel_purchase: 'Achat de carburant',
    restaurant_purchase: 'Achat au restaurant',
    balance: 'Solde du compte :',
    phone: 'Téléphone : 0551764832',
    email: 'Courriel : raa7240@gmail.com',
    address: 'Riyadh, rue du roi Fahd',
    account_desc: 'Afficher votre solde et détails des transactions',
    transfer_desc: 'Transférer de l\'argent facilement et en toute sécurité',
    salary_desc: 'Combien de jours restent avant le salaire ?',
    atm_desc: 'Trouvez le distributeur le plus proche',
    support_desc: 'Nous sommes là pour vous',
    atm_desc2: 'Nous vous montrons les succursales ANB les plus proches',
    sara: 'Sarah',
    raghd: 'Raghad',
    jawhara: 'Jawhara',
    find_atm: 'Trouver le distributeur le plus proche',
    open_map: 'Ouvrir dans Google Maps'
  },
  hi: {
    welcome: 'बेयान सैलरी में आपका स्वागत है',
    desc: 'एएनबी नेशनल बैंक द्वारा प्रदान सेवा',
    home: 'होम',
    account: 'खाता',
    transfer: 'ट्रांसफर',
    salary: 'वेतन',
    atm: 'एटीएम',
    support: 'सहायता',
    back: 'वापस',
    update: 'अद्यतन करें',
    confirm: 'ट्रांसफर की पुष्टि करें',
    transfer_money: 'धन ट्रांसफर',
    recipient: 'प्राप्तकर्ता:',
    amount: 'राशि (SAR):',
    note: 'नोट:',
    date: 'तारीख',
    desc: 'विवरण',
    amount_col: 'राशि (SAR)',
    salary_transfer: 'वेतन ट्रांसफर',
    electricity_bill: 'बिजली बिल',
    water_bill: 'पानी का बिल',
    fuel_purchase: 'ईंधन खरीद',
    restaurant_purchase: 'रेस्तरां में खरीद',
    balance: 'खाता शेष:',
    phone: 'फ़ोन: 0551764832',
    email: 'ईमेल: raa7240@gmail.com',
    address: 'रियाद, किंग फ़ाहद स्ट्रीट',
    account_desc: 'अपना शेष राशि और लेनदेन विवरण देखें',
    transfer_desc: 'आसानी और सुरक्षा के साथ पैसा ट्रांसफर करें',
    salary_desc: 'वेतन आने में कितने दिन बचे हैं?',
    atm_desc: 'निकटतम एटीएम खोजें',
    support_desc: 'हम आपके लिए यहां हैं',
    atm_desc2: 'हम आपको निकटतम एएनबी शाखाएं दिखाते हैं',
    sara: 'सारा',
    raghd: 'रघद',
    jawhara: 'जवहरा',
    find_atm: 'निकटतम एटीएम खोजें',
    open_map: 'Google Maps में खोलें'
  },
  ur: {
    welcome: 'بیان سیلری میں خوش آمدید',
    desc: 'این بی این بینک قومی کی طرف سے فراہم کردہ سروس',
    home: 'ہوم',
    account: 'اکاؤنٹ',
    transfer: 'منتقل کریں',
    salary: 'تنخواہ',
    atm: 'اے ٹی ایم',
    support: 'مدد',
    back: 'واپس',
    update: 'اپ ڈیٹ کریں',
    confirm: 'منتقلی کی تصدیق کریں',
    transfer_money: 'پیسہ منتقل کریں',
    recipient: 'وصول کنندہ:',
    amount: 'رقم (ر.س):',
    note: 'نوٹ:',
    date: 'تاریخ',
    desc: 'تفصیل',
    amount_col: 'رقم (ر.س)',
    salary_transfer: 'تنخواہ کا منتقلی',
    electricity_bill: 'بجلی کا بل',
    water_bill: 'پانی کا بل',
    fuel_purchase: 'ایندھن خرید',
    restaurant_purchase: 'ریستوران میں خرید',
    balance: 'اکاؤنٹ بیلنس:',
    phone: 'فون: 0551764832',
    email: 'ای میل: raa7240@gmail.com',
    address: 'ریاض، کنگ فہد سٹریٹ',
    account_desc: 'اپنا بیلنس اور لین دین کی تفصیلات دیکھیں',
    transfer_desc: 'آسانی اور محفوظ طریقے سے رقم منتقل کریں',
    salary_desc: 'تنخواہ آنے میں کتنے دن باقی ہیں؟',
    atm_desc: 'قریب ترین اے ٹی ایم تلاش کریں',
    support_desc: 'ہم آپ کے لیے یہاں ہیں',
    atm_desc2: 'ہم آپ کو قریب ترین اے این بی شاخیں دکھاتے ہیں',
    sara: 'سارہ',
    raghd: 'رغد',
    jawhara: 'جوهرہ',
    find_atm: 'قریب ترین اے ٹی ایم تلاش کریں',
    open_map: 'گوگل میپس میں کھولیں'
  },
  es: {
    welcome: 'Bienvenido a Bayan Salary',
    desc: 'Servicio proporcionado por ANB Banco Nacional',
    home: 'Inicio',
    account: 'Cuenta',
    transfer: 'Transferir',
    salary: 'Salario',
    atm: 'Cajero',
    support: 'Soporte',
    back: 'Volver',
    update: 'Actualizar',
    confirm: 'Confirmar transferencia',
    transfer_money: 'Transferir dinero',
    recipient: 'Destinatario:',
    amount: 'Monto (SAR):',
    note: 'Nota:',
    date: 'Fecha',
    desc: 'Descripción',
    amount_col: 'Monto (SAR)',
    salary_transfer: 'Transferencia de salario',
    electricity_bill: 'Factura de electricidad',
    water_bill: 'Factura de agua',
    fuel_purchase: 'Compra de combustible',
    restaurant_purchase: 'Compra en restaurante',
    balance: 'Saldo de la cuenta:',
    phone: 'Teléfono: 0551764832',
    email: 'Correo: raa7240@gmail.com',
    address: 'Riad, calle King Fahd',
    account_desc: 'Ver saldo y detalles de transacciones',
    transfer_desc: 'Transferir dinero fácil y seguro',
    salary_desc: '¿Cuántos días faltan para el salario?',
    atm_desc: 'Encuentra el cajero más cercano',
    support_desc: 'Estamos aquí para ti',
    atm_desc2: 'Te mostramos las sucursales ANB más cercanas',
    sara: 'Sara',
    raghd: 'Raghad',
    jawhara: 'Jawhara',
    find_atm: 'Encontrar cajero más cercano',
    open_map: 'Abrir en Google Maps'
  }
};

// --- تغيير اللغة ---
function changeLanguage(lang) {
  document.querySelectorAll('[data-tr]').forEach(el => {
    const key = el.getAttribute('data-tr');
    if (translations[lang][key]) {
      el.innerHTML = translations[lang][key];
    }
  });
  document.getElementById('html').lang = lang;
  if (lang === 'ar') {
    document.getElementById('html').dir = 'rtl';
    document.body.style.fontFamily = "'Cairo', sans-serif";
  } else {
    document.getElementById('html').dir = 'ltr';
    document.body.style.fontFamily = "'Roboto', sans-serif";
  }
}

// --- قارئ صوتي ---
function speak(key) {
  const text = document.querySelector(`[data-tr="${key}"]`)?.innerText || key;
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = document.getElementById('html').lang === 'ar' ? 'ar-SA' :
                   document.getElementById('html').lang === 'en' ? 'en-US' :
                   document.getElementById('html').lang === 'fr' ? 'fr-FR' :
                   document.getElementById('html').lang === 'hi' ? 'hi-IN' :
                   document.getElementById('html').lang === 'ur' ? 'ur-PK' :
                   'es-ES';
  speechSynthesis.speak(utterance);
}

// --- التحكم في الوضع الليلي ---
const body = document.body;
const themeToggle = document.getElementById('theme-toggle');
themeToggle.addEventListener('click', () => {
  body.classList.toggle('dark-mode');
  themeToggle.textContent = body.classList.contains('dark-mode') ? 'الوضع النهاري' : 'الوضع الليلي';
});

// --- عرض القسم ---
function showSection(id) {
  document.querySelectorAll('.section').forEach(sec => {
    sec.classList.remove('active');
    sec.style.display = 'none';
  });
  const section = document.getElementById(id);
  if (section) {
    section.classList.add('active');
    section.style.display = 'block';
  }
  if (id === 'salary') updateCountdown();
  if (id === 'atm') initMap();
}

// --- العد التنازلي للراتب ---
function updateCountdown() {
  const now = new Date();
  let salaryDate = new Date(now.getFullYear(), 7, 27);
  if (now > salaryDate) salaryDate = new Date(now.getFullYear() + 1, 7, 27);
  const diff = salaryDate - now;
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const el = document.getElementById('countdown');
  const lang = document.getElementById('html').lang;
  if (days > 0) {
    el.innerHTML = lang === 'ar' ? `⏳ بقي <strong>${days}</strong> يوم على راتبك (27 أغسطس)` :
                   lang === 'en' ? `⏳ <strong>${days}</strong> days until your salary (August 27)` :
                   lang === 'fr' ? `⏳ <strong>${days}</strong> jours avant votre salaire (27 août)` :
                   lang === 'hi' ? `⏳ आपके वेतन में <strong>${days}</strong> दिन शेष (27 अगस्त)` :
                   lang === 'ur' ? `⏳ آپ کے تنخواہ تک <strong>${days}</strong> دن باقی (27 اگست)` :
                   `⏳ <strong>${days}</strong> días hasta su salario (27 de agosto)`;
  } else if (days === 0) {
    el.innerHTML = lang === 'ar' ? '🎉 راتبك اليوم! مبروك 🎉' :
                   lang === 'en' ? '🎉 Salary day! Congratulations 🎉' :
                   '🎉 Jour de salaire ! Félicitations 🎉';
  } else {
    el.innerHTML = lang === 'ar' ? 'تم استلام الراتب.' : 'Salary received.';
  }
}

// --- فتح نموذج التحويل ---
function openTransferForm(name, img) {
  document.getElementById('recipient-name').textContent = name;
  showSection('transfer-form');
}

// --- تأكيد التحويل ---
function confirmTransfer() {
  const amount = document.getElementById('amount').value;
  const phone = prompt('أدخل رقم الجوال لتأكيد التحويل:');
  if (!phone) {
    alert('الرجاء إدخال رقم الجوال');
    return;
  }

  // محاكاة إرسال رمز SMS
  const otp = Math.floor(100000 + Math.random() * 900000).toString();
  console.log('رمز التحقق (للاختبار):', otp);
  const userOtp = prompt(`تم إرسال رمز إلى ${phone}\nالرمز: ${otp}\nأدخل الرمز للتأكيد:`);

  if (userOtp === otp) {
    alert(`تم التحويل بنجاح بمبلغ ${amount} ر.س`);
    window.location.href = 'api.html';
  } else {
    alert('الرمز غير صحيح');
  }
}

// --- الخريطة ---
let map;
function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 14,
    center: { lat: 24.7136, lng: 46.6753 },
  });
  new google.maps.Marker({
    position: { lat: 24.7136, lng: 46.6753 },
    map: map,
    title: "فرع ANB - الرياض",
  });
}

// --- البحث عن أقرب صراف ---
function findNearestATM() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(position => {
      const pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      map.setCenter(pos);
      new google.maps.Marker({
        position: pos,
        map: map,
        title: "موقعك الحالي",
        icon: "http://maps.google.com/mapfiles/ms/micons/blue-dot.png"
      });
    }, () => {
      alert("يرجى تفعيل الموقع للبحث عن أقرب صراف.");
    });
  } else {
    alert("المتصفح لا يدعم تحديد الموقع.");
  }
}

// --- عند التحميل ---
window.onload = () => {
  changeLanguage('ar');
  showSection('home');
};
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>تسجيل الدخول - Bayan Salary</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .login-container {
      max-width: 400px;
      width: 90%;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      overflow: hidden;
      text-align: center;
      padding: 2rem;
    }
    h2 { margin-bottom: 1.5rem; color: #003366; }
    p { color: #666; margin-bottom: 1.5rem; }
    .pin-input {
      display: flex;
      justify-content: center;
      gap: 0.8rem;
      margin: 1rem 0;
    }
    .pin-input input {
      width: 2.5rem;
      height: 2.5rem;
      text-align: center;
      font-size: 1.4rem;
      border: 2px solid #ccc;
      border-radius: 8px;
      outline: none;
    }
    .pin-input input:focus {
      border-color: #003366;
      background: #f0f6ff;
    }
    button {
      padding: 0.7rem 1.5rem;
      background: #003366;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin: 0.5rem;
    }
    button:hover { transform: scale(1.02); }
    .biometric-btn {
      background: white;
      border: 1px solid #ccc;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      margin: 1rem auto;
      cursor: pointer;
    }
    .biometric-btn svg {
      width: 32px;
      height: 32px;
      color: #003366;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <h2><span data-tr="login_title">تسجيل الدخول</span></h2>
    <p><span data-tr="pin_prompt">أدخل رمز PIN المؤلف من 4 أرقام</span></p>

    <div class="pin-input">
      <input type="text" maxlength="1" data-index="0" />
      <input type="text" maxlength="1" data-index="1" />
      <input type="text" maxlength="1" data-index="2" />
      <input type="text" maxlength="1" data-index="3" />
    </div>

    <button onclick="verifyPIN()"><span data-tr="confirm">تأكيد</span></button>
    <button onclick="biometricLogin()"><span data-tr="biometric_login">الدخول بالبصمة</span></button>
  </div>

  <script>
    let correctPIN = '';

    // توليد PIN عشوائي
    window.onload = () => {
      correctPIN = Math.floor(1000 + Math.random() * 9000).toString();
      console.log('رمز PIN (للاختبار):', correctPIN);
      updateTranslations();
    };

    // التنقل التلقائي بين حقول PIN
    document.querySelectorAll('.pin-input input').forEach((input, index) => {
      input.addEventListener('input', function () {
        if (input.value.length === 1 && index < 3) {
          document.querySelectorAll('.pin-input input')[index + 1].focus();
        }
      });
      input.addEventListener('keydown', function (e) {
        if (e.key === 'Backspace' && input.value === '' && index > 0) {
          document.querySelectorAll('.pin-input input')[index - 1].focus();
        }
      });
    });

    // التحقق من PIN
    function verifyPIN() {
      const pin = Array.from(document.querySelectorAll('.pin-input input'))
                      .map(input => input.value)
                      .join('');
      if (pin === correctPIN || pin.length === 4) { // تجاوز الرمز (أي رمز مكون من 4 أرقام يفتح)
        localStorage.setItem('isLoggedIn', 'true');
        window.location.href = 'index.html';
      } else {
        alert(translations[document.getElementById('lang-select')?.value || 'ar'].pin_error);
      }
    }
    // الدخول بالبصمة
    async function biometricLogin() {
      if (window.PublicKeyCredential && navigator.credentials) {
        try {
          const supported = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
          if (supported) {
            const credential = await navigator.credentials.get({
              publicKey: {
                challenge: new Uint8Array(32),
                rpId: window.location.hostname,
                allowCredentials: [],
                userVerification: "required"
              }
            });
            if (credential) {
              localStorage.setItem('isLoggedIn', 'true');
              window.location.href = 'index.html';
            }
          } else {
            alert(translations[document.getElementById('lang-select')?.value || 'ar'].biometric_not_supported);
          }
        } catch (err) {
          alert(translations[document.getElementById('lang-select')?.value || 'ar'].biometric_failed);
        }
      } else {
        alert(translations[document.getElementById('lang-select')?.value || 'ar'].biometric_unsupported);
      }
    }

    // منع الدخول المباشر
    if (window.location.pathname.endsWith('index.html') && !localStorage.getItem('isLoggedIn')) {
      window.location.href = 'login.html';
    }

    // الترجمات
    const translations = {
      ar: {
        login_title: 'تسجيل الدخول',
        pin_prompt: 'أدخل رمز PIN المؤلف من 4 أرقام',
        confirm: 'تأكيد',
        biometric_login: 'الدخول بالبصمة',
        pin_error: 'الرمز غير صحيح',
        biometric_not_supported: 'المصادقة الحيوية غير مدعومة على جهازك.',
        biometric_failed: 'فشل في التحقق بالبصمة.',
        biometric_unsupported: 'المتصفح لا يدعم المصادقة الحيوية.'
      },
      en: {
        login_title: 'Login',
        pin_prompt: 'Enter 4-digit PIN',
        confirm: 'Confirm',
        biometric_login: 'Login with Biometric',
        pin_error: 'PIN is incorrect',
        biometric_not_supported: 'Biometric authentication not supported.',
        biometric_failed: 'Biometric verification failed.',
        biometric_unsupported: 'Browser does not support biometric login.'
      },
      fr: {
        login_title: 'Connexion',
        pin_prompt: 'Entrez le code PIN à 4 chiffres',
        confirm: 'Confirmer',
        biometric_login: 'Connexion biométrique',
        pin_error: 'Code incorrect',
        biometric_not_supported: 'Authentification biométrique non prise en charge.',
        biometric_failed: 'Échec de la vérification biométrique.',
        biometric_unsupported: 'Le navigateur ne prend pas en charge la connexion biométrique.'
      },
      hi: {
        login_title: 'लॉगिन',
        pin_prompt: '4 अंकों का पिन दर्ज करें',
        confirm: 'पुष्टि करें',
        biometric_login: 'बायोमेट्रिक से लॉगिन करें',
        pin_error: 'पिन गलत है',
        biometric_not_supported: 'आपके डिवाइस पर बायोमेट्रिक प्रमाणीकरण समर्थित नहीं है।',
        biometric_failed: 'बायोमेट्रिक सत्यापन विफल रहा।',
        biometric_unsupported: 'ब्राउज़र बायोमेट्रिक लॉगिन का समर्थन नहीं करता।'
      },
      ur: {
        login_title: 'لاگ ان',
        pin_prompt: '4 ہندسوں کا پن درج کریں',
        confirm: 'تصدیق کریں',
        biometric_login: 'بائیومیٹرک لاگ ان',
        pin_error: 'پن غلط ہے',
        biometric_not_supported: 'آپ کے ڈیوائس پر بائیومیٹرک تصدیق سپورٹ نہیں کی جاتی۔',
        biometric_failed: 'بائیومیٹرک تصدیق ناکام ہو گئی۔',
        biometric_unsupported: 'براؤزر بائیومیٹرک لاگ ان کی حمایت نہیں کرتا۔'
      },
      es: {
        login_title: 'Iniciar sesión',
        pin_prompt: 'Ingrese el PIN de 4 dígitos',
        confirm: 'Confirmar',
        biometric_login: 'Iniciar sesión con biométrica',
        pin_error: 'PIN incorrecto',
        biometric_not_supported: 'La autenticación biométrica no es compatible.',
        biometric_failed: 'Verificación biométrica fallida.',
        biometric_unsupported: 'El navegador no admite el inicio de sesión biométrico.'
      }
    };
    function updateTranslations() {
      const lang = localStorage.getItem('loginLang') || 'ar';
      document.querySelectorAll('[data-tr]').forEach(el => {
        const key = el.getAttribute('data-tr');
        if (translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    }

    // تغيير لغة النموذج (اختياري)
    window.changeLoginLang = function(lang) {
      localStorage.setItem('loginLang', lang);
      updateTranslations();
    };
  </script>
</body>
</html>
